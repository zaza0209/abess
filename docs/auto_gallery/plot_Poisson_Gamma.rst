
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_gallery\plot_Poisson_Gamma.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_gallery_plot_Poisson_Gamma.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_gallery_plot_Poisson_Gamma.py:


Positive response: Poisson and Gamma regression
=======================================================

.. GENERATED FROM PYTHON SOURCE LINES 6-21

Poisson Regression
----------------------
Poisson Regression involves regression models in which the response variable is in the form of counts. For example, the count of number of car accidents or number of costumers in line at a reception desk. The expectation of the response variables is assumed to follow a Poisson distribution.

The general mathematical equation for Poisson regression is

..math::
  \log(E(y)) = \beta_0 + \beta_1 X_1+\beta_2 X_2+\dots+\beta_p X_p.


### Simulated Data Example

We generate some artificial data using this logic.
Consider a dataset containing `n=100` observations with `p=6` variables. The `make_glm_data()` function allow you to generate simulated data. By specifying `k = 3`, here we set only 3 of the 6 variables have effect on the expectation of the response. 


.. GENERATED FROM PYTHON SOURCE LINES 21-38

.. code-block:: default


    import numpy as np
    from abess.datasets import make_glm_data
    np.random.seed(0)

    n = 100
    p = 6
    k = 3
    data = make_glm_data(n = n, p = p , k = k, family="poisson")
    print("non-zero:\n", np.nonzero(data.coef_))
    print("real coef:\n", data.coef_)



    print("the first 5 x:\n", data.x[0:5,])
    print("the first 5 y:\n",data.y[0:5])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    non-zero:
     (array([0, 2, 5], dtype=int64),)
    real coef:
     [8.97519346 0.         7.74067053 0.         0.         6.51945346]
    the first 5 x:
     [[ 0.10206398  0.02183018  0.07262124  0.14137693  0.13114375 -0.05882929]
     [ 0.05416649 -0.0097946   0.00670931  0.02410382  0.01464568  0.10943946]
     [ 0.04304185  0.00586154  0.04003711  0.01917503  0.10589907 -0.0053969 ]
     [ 0.01668117 -0.05009082 -0.14252873  0.03967493  0.06333941 -0.04255895]
     [ 0.1318219  -0.08451131  0.01578489 -0.0141981   0.10851494  0.1104834 ]]
    the first 5 y:
     [0 3 0 1 9]




.. GENERATED FROM PYTHON SOURCE LINES 39-42

Model Fitting
^^^^^^^^^^^^^^^^^^^^^^^ 
The `PoissonRegression()` function in the **abess** package allows you to perform best subset selection in a highly efficient way. You can call the function using formula like: 

.. GENERATED FROM PYTHON SOURCE LINES 42-49

.. code-block:: default



    from abess.linear import PoissonRegression

    model = PoissonRegression(support_size = range(7))
    model.fit(data.x, data.y)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    PoissonRegression(always_select=[], support_size=range(0, 7))



.. GENERATED FROM PYTHON SOURCE LINES 50-51

where `support_size` contains the level of sparsity we consider, and the program can adaptively choose the "best" one. The result of coefficients can be viewed on `model.coef_`:

.. GENERATED FROM PYTHON SOURCE LINES 51-56

.. code-block:: default




    print(model.coef_)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    [6.97861535 0.         7.00639571 0.         0.         7.23806417]




.. GENERATED FROM PYTHON SOURCE LINES 57-62

So that the first, third and last variables are thought to be useful in the model (the chosen sparsity is 3), which is the same as "real" variables. What's more, the predicted coefficients are also close to the real ones.

More on the Results
^^^^^^^^^^^^^^^^^^^^^^^ 
Actually, we can also plot the path of coefficients in abess process. This can be computed by fitting the `support_size` in one number from 0 to 6:

.. GENERATED FROM PYTHON SOURCE LINES 62-83

.. code-block:: default




    import matplotlib.pyplot as plt

    coef = np.zeros((7, 6))
    ic = np.zeros(7)
    for s in range(7):
        model = PoissonRegression(support_size = s)
        model.fit(data.x, data.y)
        coef[s, :] = model.coef_
        ic[s] = model.ic_

    for i in range(6):
        plt.plot(coef[:, i], label = i)

    plt.xlabel('support_size')
    plt.ylabel('coefficients')
    plt.legend()
    plt.show()




.. image-sg:: /auto_gallery/images/sphx_glr_plot_Poisson_Gamma_001.png
   :alt: plot Poisson Gamma
   :srcset: /auto_gallery/images/sphx_glr_plot_Poisson_Gamma_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 84-85

And the decreasing of information criterion (by default, we use EBIC):

.. GENERATED FROM PYTHON SOURCE LINES 85-93

.. code-block:: default




    plt.plot(ic, 'o-')
    plt.xlabel('support_size')
    plt.ylabel('EBIC')
    plt.show()




.. image-sg:: /auto_gallery/images/sphx_glr_plot_Poisson_Gamma_002.png
   :alt: plot Poisson Gamma
   :srcset: /auto_gallery/images/sphx_glr_plot_Poisson_Gamma_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 94-113

The lowest point is shown on `support_size=3` and that's why the program choose 3 variables as output.

Gamma Regression
----------------------
Gamma regression can be used when you have positive continuous response variables such as payments for insurance claims, or the lifetime of a redundant system. It is well known that the density of Gamma distribution can be represented as a function of a mean parameter (:math:`\mu`) and a shape parameter (:math:`\alpha`), specifically,

..math::
  f(y \mid \mu, \alpha)=\frac{1}{y \Gamma(\alpha)}\left(\frac{\alpha y}{\mu}\right)^{\alpha} e^{-\alpha y / \mu} {I}_{(0, \infty)}(y),


where:math:`I(\cdot)` denotes the indicator function. In the Gamma regression model, response variables are assumed to follow Gamma distributions. Specifically, 

..math::
  y_i \sim Gamma(\mu_i, \alpha),


where:math:`1/\mu_i = x_i^T\beta`.

Compared with Poisson regression, this time we consider the response variables as (continuous) levels of satisfaction.

.. GENERATED FROM PYTHON SOURCE LINES 113-133

.. code-block:: default


    # Simulated Data Example
    # ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 
    # Firstly, we also generate data from `make_glm_data()`, but `family = "gamma"` is given this time:

    import numpy as np
    from abess.datasets import make_glm_data
    np.random.seed(1)

    n = 100
    p = 6
    k = 3
    data = make_glm_data(n = n, p = p , k = k, family = "gamma")
    print("non-zero:\n", np.nonzero(data.coef_))
    print("real coef:\n", data.coef_)


    print("the first 5 x:\n", data.x[0:5,])
    print("the first 5 y:\n", data.y[0:5])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    non-zero:
     (array([3, 4, 5], dtype=int64),)
    real coef:
     [ 0.          0.          0.         90.41376366 86.92076451 80.45913757]
    the first 5 x:
     [[ 0.10469003 -0.04220527 -0.03896451 -0.06864505  0.04842066 -0.15316507]
     [ 0.11245266 -0.05071946  0.01613769 -0.01590014  0.08603088 -0.13774991]
     [-0.02075564 -0.02923308  0.06912737 -0.07036923 -0.01699446 -0.06225191]
     [ 0.00274048  0.02584945 -0.07619623  0.07338048  0.0507013   0.02589445]
     [ 0.05806975 -0.04630548 -0.01260519 -0.05985853 -0.02301133  0.0276736 ]]
    the first 5 y:
     [0.06074422 0.04932709 0.06413723 0.02388531 0.04567009]




.. GENERATED FROM PYTHON SOURCE LINES 134-137

Model Fitting
^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 
We apply the above procedure for gamma regression simply by using `abess.linear.GammaRegression`. It has similar member functions for fitting.

.. GENERATED FROM PYTHON SOURCE LINES 137-145

.. code-block:: default




    from abess.linear import GammaRegression

    model = GammaRegression(support_size = range(7), cv = 5) # use CV (fold = 5) for fitting
    model.fit(data.x, data.y)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    GammaRegression(always_select=[], cv=5, support_size=range(0, 7))



.. GENERATED FROM PYTHON SOURCE LINES 146-147

The fitted coefficients:

.. GENERATED FROM PYTHON SOURCE LINES 147-152

.. code-block:: default



    print(model.coef_)






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    [ 0.          0.          0.         86.5315717  91.56037073 95.32619108]




.. GENERATED FROM PYTHON SOURCE LINES 153-156

More on the Results
^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 
We can also plot the path of coefficients in abess process.

.. GENERATED FROM PYTHON SOURCE LINES 156-177

.. code-block:: default




    import matplotlib.pyplot as plt

    coef = np.zeros((7, 6))
    loss = np.zeros(7)
    for s in range(7):
        model = GammaRegression(support_size = s)
        model.fit(data.x, data.y)
        coef[s, :] = model.coef_
        loss[s] = model.test_loss_

    for i in range(6):
        plt.plot(coef[:, i], label = i)

    plt.xlabel('support_size')
    plt.ylabel('coefficients')
    plt.legend()
    plt.show()




.. image-sg:: /auto_gallery/images/sphx_glr_plot_Poisson_Gamma_003.png
   :alt: plot Poisson Gamma
   :srcset: /auto_gallery/images/sphx_glr_plot_Poisson_Gamma_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 178-181

R tutorial
-------------------- 
For R tutorial, please view [https://abess-team.github.io/abess/articles/v04-PoissonGammaReg.html](https://abess-team.github.io/abess/articles/v04-PoissonGammaReg.html).


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.224 seconds)


.. _sphx_glr_download_auto_gallery_plot_Poisson_Gamma.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_Poisson_Gamma.py <plot_Poisson_Gamma.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_Poisson_Gamma.ipynb <plot_Poisson_Gamma.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
